;(node ntype (:p1 v1 :p2 v2) left right)
;macro: (barnode ntype (:p1 v1 :p2 v2) spec mod head bar)
;(morph ntype (:p1 v1 :p2 v2) root)
;(var name :p1 v1 :p2 v2)
;(collect/distribute ntype var1 var2 var3)

; TODO
; * linear & surface rules
; * transduce
; * where to store translation rules?
; ** retrieve relevant rule set
; * generation rules
; * gen/make/parse
; * interface

(defvar *lang*)

;;;;;;;;;;
; UTILITIES
;;;;;;;;;;
(defun flatten (tree)
  (if (listp tree)
      (mapcan #'flatten tree)
    (list tree)))
(defun symb (&rest parts)
  (intern (format nil "狺疳螋螬┅ㄤ彐鲠灬礅溽怛徙脲舡戾鲥癌ㄤ彐躅怛徙脲舡灬礅溽蝈徜弪篝蝈犴汨狎ㄤ邈灬蝈ㄩ珙矧汨狎┅戾舄è灬礅溽怛徙脲舡戾鲥ū灬礅溽怛徙脲舡戾鲥飑ㄩ灬礅溽怛徙脲舡戾鲥暴н簌礅н灬礅溽怛徙脲舡戾鲥飑┅啜灬礅溽ì螬蝈徜溴扉黹翦洵扉篝＼篝蝈犴舂┅箦舡磲泸锃汨狎徙翦＼＇怛徙脲舡灬礅溽蝈徜弪箦舡磲泸锃汨狎徙翦＼ㄧ弭磲泸锃汨狎徙翦＼铋飑ㄤ彐磲泸戾舡珏簌眢怙澌怙澌啜戾磲疸狎垤轶唰ㄧ孱簌簌礅镬钺礤擤┹簌眢棱镤┅ㄤ彐磲泸眦猸殒鲠骘蝽弩镳糸镱犰铒戾舡珏镫啜眭祠轲戾鲠祯瀛忾钿ì鲠镫骘蝽ㄩ镫弩铒┅┅换换换换换盘磐盼杂换换换换换ㄤ彐磲泸铒溴铘疱狎珞蝈篝汨殪潋孱啜扉篝ь镤К铘疱狎珞楞栝熹蝈瞟ㄤ彐磲泸盹蝠铘疱狎珞蝻雉戾舡珏蝈屮轶趔痫屮轶趔暴戾è弪ㄦ矧磲铋⑼矧痂屙滹弩铒屮轶轭灬铉踽珏鏖翳疳螋镦箴邋汨岙蝻雉灬铉铘疱┅啜扉篝ы矧痂К铘疱眭祠轲戾鲠祯瀛忾钿ì痫屮轶趔暴ㄧ弭栳箬К铘疱ㄧ弭灬铉ъ屮殂镱┅ㄩ屮轶趔眭祠轲戾鲠祯瀛忾钿ì蝈屮轶趔博ㄧ弭栳箬К蝻雉痫螬ㄩ屮轶趔ㄡ痧孱扉篝泪蜱螬蝈螬ㄥ蝌矧弪颟┅ㄥ蝌矧弪颟┅┅┅轸黹玷忮黠螋屮疱蜷礤铘轭麸箦殒轸黠蹯忮驷篝弪麸栳鲥珏赧狎滹祜镫躔轭篝遽镦泔瘗轭翳狎珞扉篝轭麸遽汨轭篝犷沐ㄤ彐躅蝈玳篝弪盹蝠痫蝻雉蝈篝狎珞戾è戾ㄧ弭灬铉ъ屮殂镱┅躅戾篌戾箦翩ㄧ弭灬铉ъ屮殂镱磲脲栳箬翎忪呼弩＇羼┅眭祠轲戾鲠祯瀛忾钿痫箐泗鹂ㄧ弭栳箬痫戾躅戾篌鹂箦翩ㄧ弭栳箬痫戾磲脲栳箬翎忪呼弩＇羼┅眭祠轲戾鲠祯瀛忾钿蝻雉溷蚩ㄧ弭栳箬蝻雉痫箐泗ㄩ蚩ㄥ蝌矧ㄦ矧磲铋⒘趑屙痿轭麸蝈蝈玳篝弪蝻雉鏖翳疳螋镦箴邋汨轭灬铉狨珏岙蝻雉痫灬铉┅箦翩ㄧ弭栳箬蝻雉痫箐泗狎珞┅┅┅ㄤ彐躅蝈玳篝弪磲铢盹蝠梵痫狎珞蝻雉螬磲疸狎灬礅溽颟ㄩ扉篝颟蝈玳篝弪盹蝠痫ㄣ狎颟轰轶痨狴ㄣ徜颟狎珞蝈玳篝弪盹蝠痫轰轶痨狴篝蜷铉滹黝汜箦簌礅镬钺礤颟狎珞┅蝻雉螬ㄤ彐磲泸鲠钺礤蝈篝蝈耋啜扉篝鲠ㄩ铘弪簌礅镬钺礤钺礤щ妁黠蜾莉羼螬麸滹弪蝻汨邈腴铉ㄤ彐磲泸忉蝾镤瀛脲铘疱狎珞脲箴邈盹桢徜忉颟戾舄è钺礤簌礅镬钺礤铘疱┅ㄢ狍篚怏羼钺礤ū戾铉翳钺礤┅┅啜铒溴簌礅忉箦些狎珞箴邈铒溴簌礅忉箦ы镤铋盹铒溴簌礅忉箦р狎铋桢徜忉颟┅┅ㄤ彐磲泸忉蝾镤铘疱狎珞蝈篝疳螋螬啜忉蝾镤瀛脲铘疱狎珞括磲疸犷＇扉篝ㄥ祠Жīê桢徜ê桢徜衡狎ê箴邈鸿遽衡狎ê箴邈喉镤鸿遽衡狎┅戾铉翳疳螋螬疳螋螬┅ㄤ彐磲泸泔祆邈铘疱蝈篝鲠蝮啜扉篝с镬戾泗К铘疱丽狎螬ㄤ彐磲泸溟篝蜷怩翦铘疱蝈篝鲠蝮啜狃疱钿Ж铒溴铘疱īㄡ痧禊＇狃疱钿磲疸狎坶扉篝擤扉篝擤鲠蝮┅┅ㄤ彐躅珏趄镲趔趄邋麒孱扉篝趄邋ㄩㄥㄣ狎趄邋ь镤濠磲疸犷＇珏趄镲趔ㄣ滗潋趄邋┅麒孱ㄥㄣ狎趄邋ы矧痂ㄣ滗潋趄邋┅┅换换换换换艺膛换换换换换ㄤ彐躅灬礅溟纟蝈篚祠趄邋灬忮祗è溟篥狎趄ㄩ扉篝趄ㄩㄥㄣ狎趄鲠颟ㄣ徜趄ㄩㄥㄣ狎趄с镬戾泗ㄣ镱т轶趄殁豸磲疸狎＇溟篥狎ㄣ潋趄┅磲疸狎＇溟篥狎趄┅趄┅啜灬礅溽é脲括蝈盹鲥殒埏铒簌礅镬擤ㄦ怙躅漯擤蝈盹鲥漉痨殂狒弩ㄦ灬趑孱趄邋┅犰祜鳝雉桢颦脲螬ㄤ轶鲠趄邋┅┅ㄤ彐磲泸忉箝悱蝓戾ㄦ矧蝈篚祠戾è箦ㄧ孱簌愆鲠蝮ㄧ孱簌愆磲翥ㄧ孱簌愆┅啜灬礅溽ì箦瞟眭祠轲戾鲠祯瀛忾钿ì鲠蝮磲翥瑭ㄧ弭鲠蝮箦骘蝽麒孱磲翥ㄡ痧禊灬礅溟纟蝈篚祠蝈篚祠鲠蝮┅┅┅ㄤ彐磲泸眭祠榄蝓戾é蝈篝灬弪螬戾舡珏ㄢ祀骖箦犰飙蝓戾蝓戾鲠蝮疳蝈铘鲠蝮啜灬礅溽ì箦瞟戾è犰飙蝓戾К磲疸狎垌狃汜垤轶ㄣ狎卟灬礅溟纟蝈篚祠矧ㄣ徜卟ㄣ狎卟┅┹咻灬弪螬┅ㄢ祜汶忪灬忮祗è骖ì蝓戾疳蝈铘鲠蝮ㄩ蝓戾祜镳骘ì颟轭ㄣ狎蝓戾螬殒ㄧ弭鲠蝮姗蝈趱蝾戾è鲠蝮轸┅箦翩ㄧ弭鲠蝮豪ì骖ㄧ弭鲠蝮豪ㄣ潋蝓戾螬┅ㄡ痧禊ㄡ痧孱鲠蝮疳蝈铘鲠蝮┅骈钺祆蝈趱蝾骝镯忪铋飑螬┅ì骖箦犰飙蝓戾铋飑┅┅┅ㄤ彐躅箦麴蝻铒溴痱镳鲠飑箦翩ㄧ弭ㄣ徜潋铒溴痱镳鲠飑铒溴轸痫篌殁戾翳狒翳轶鏖祆栳鲥躅轭翦钿邃箝溴彐驽泗殒箫徜泔瘗镳弪狒轱ㄤ彐躅泔瘗痱镳篁箴蝻溴篝镳糸镱犰漯蝻皓箦翩ㄧ弭ㄣ徜潋溴篝矧漯蝻箴蝻皓ㄧ弭ㄣ徜潋篁悌箴蝻皓溴篝换换换换换艺膛列刑擅猎上换换换换换ㄤ彐躅狃痨蝓戾蝓戾箦箦瞟灬忮祗è痱镤蹉扉篝螬ㄩ扉篝戾è蝈篝痱镤蹉ㄣ潋扉篝螬┅磲疸犷垌狃汜坫镱卟蝈篝ㄣ狎扉篝螬┅扉篝铋飑┅篝徵ㄩ瞽箦蝓戾螬戾èㄩㄡ钿扉篝轭箦瞟ㄥㄣ狎轭箦瞟ь镤濠磲疸狎坩痧孱篚怏羼轭箦畅咻痱镤蹉磲疸狎垠翎珏蝓戾筝ㄣ滗潋轭箦瞟┅扉篝轭箦瞟┅磲疸犷埏祜镳骘蝓戾轭蝓戾殒ㄦ躅汜祆蝓戾擤泔祆邈轸扉篝擤螬┅蝈漉沐灬礅溽颟磲疸犷垠翎珏蜉螬ㄣ镱扉篝箦瞟蝓戾箦舂┅ㄤ彐躅珏赧狎趄邋疳趑弪瞟灬忮祗è驷殪ī蝈趱蝾骝镯珏赧狎鲠祯弩铋铋飑┅ㄧ趄痿ㄣ镱è犷扉篝痿ㄥㄣ狎痿鲠颟鲠蜷徕戾ㄩㄡ钿铛祆趄铒ㄧ弭痿猴痿┅ㄦ衢飑ㄡ痧孱扉篝ㄣ徜痿趄祜镳骘脲狎绌镱ㄣ滗痿怡＇沅潋狃疱钿轭ㄣ狍脲ê铘疱躅戾篌ㄥ狎ㄣ徜趄┅ㄦ衢飑┅┅┅麸滹汨邈鲠蜷徕戾泔钿轸轱铙è矧铒扉篝趄┅铒扉篝痿┅躅戾篌ㄥ聃犰趄痿ㄦ衢飑┅è犷ㄥ豉疱镦ㄣ狎趄┅щ妁黠蜾铒痿┅屙痿扉篝磲翥栝铉狎珲礤铘è犷ㄥ豉疱镦ㄣ狎趄┅щ妁黠蜾ㄥ豉疱镦ㄣ狎痿┅щ妁黠蜾┅狎珈轶趔祜镳骘痱镳鲠飑镱痿怡＇沅潋狃疱钿轭ㄩ礤礅弪痱镳趄ㄧㄧ弭趄痱镳鲠飑ㄦ衢飑┅翳弪濮痱镡徕禊忮趑弪盹蝈彐骈汩孱舂麽麸滹翳轶犷麇磲弼孱趱犰禊铄邃麸汨邈珈镡犰骘盹蝠桢礤翳秕玷箦翳溴骈铋糸镱镦盹蝠徕秭骘骢螋桢溟筱躞箝镱è犷ㄥㄣ狎趄ㄣ狎痿┅戾铉翳趄戾铉翳痿┅磲疸犷＇琏ㄣ潋趄ㄣ潋痿┅è犷ㄥㄣ狎痿с镬戾泗ㄥㄣ狎趄ь镤濠ㄥㄣ徜痿ㄣ徜趄┅戾è趄徙ㄧ孱簌愆盹溴ㄧ孱簌愆鲠祯ㄧ孱簌愆鲠蝮磲疸狎灬礅溽鲠颟麒孱ㄥㄣ狎鲠颟鲠颟瘐箬ㄣ徜鲠颟鲠蝮箦翩ㄧ弭ㄣ徜鲠颟盹溴ㄣ镱è珏翩ㄣ滗鲠颟猴痿猴痿è珏翩ㄣ滗鲠颟喉蹯糸喉蹯糸侯矧磲飑┅┅ㄣ滗痿┅祜镳骘汨轭ㄣ滗潋趄狃疱钿轭祜镳骘鲠轭ㄣ滗痿滹ㄩㄥㄣ狎鲠颟鲠颟麒孱矧铒ㄧ弭ㄣ徜鲠颟趄徙氅ㄥㄧ弭ㄣ徜鲠颟盹溴喉蹯糸┅眦猸殒ㄧ弭鲠蝮汨鲠颟痱镧箦翩ㄧ弭ㄣ徜鲠颟趄徙氅舂麒孱ㄥㄧ弭ㄣ徜鲠颟盹溴喉蹯糸瘐箬汨ㄧ弭ㄣ徜鲠颟鲠祯濠蝈礞ㄣ徜鲠颟┅蝈趱蝾雯┅眦猸殒ㄧ弭鲠蝮汨鲠颟蝈趱蝾雯┅轭麸蝈骈钺祆磲疸犷灬礅溽鲠颟ㄣ狍ㄧ弭鲠盹溴ê铒蝽犰躅戾篌ㄧ弭鲠趄徙氅ㄦ衢飑┅ê镳躅戾篌ㄧ弭鲠趄徙氅瘐箬蝈铋飑瘐箬蝈鲠颟┅ê眭祠痱镧瘐箬蝈ㄧ弭鲠鲠祯濠瘐箬蝈鲠颟┅┅鲠蝮┅┅ㄦ衢飑┅┅鲠祯弩ㄧ趄邋疳趑弪瞟舂┅换换换换换砸廖犹猎上换换换换换ㄤ彐躅趄犷蟓簌礅篁溴篝簌礅篁Л麸溴篝┅换换换换换牧粤晌姓换换换换换ㄤ彐躅灬铉踽珏簌铘狲灬铉踽珏蝈篝篝徵弩箦翩ㄧ弭灬铉踽珏簌铘狲篝徵弩┅ㄤ彐躅灬铉踽珏扉铄狎灬铉踽珏蝈篝篝徵弩箦翩ㄧ弭灬铉踽珏ъ轭遽颟篝徵弩┅ㄤ彐躅灬铉踽珏篚蜴徙灬铉踽珏蝈篝篝徵弩箦翩ㄧ弭灬铉踽珏篚蜴徙濠篝徵弩┅